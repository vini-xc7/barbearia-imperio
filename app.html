<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barbearia Elite</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0d0d0d;
  color:white;
}

.hero{
  text-align:center;
  padding:60px 20px;
  background:linear-gradient(135deg,#000,#1a1a1a);
}

.hero h1{
  font-size:32px;
  margin-bottom:10px;
  color:#d4af37;
}

.hero p{
  color:#ccc;
}

.btn{
  background:#d4af37;
  color:black;
  padding:12px 25px;
  border:none;
  cursor:pointer;
  margin-top:20px;
  font-weight:bold;
}

.section{
  padding:40px 20px;
  max-width:500px;
  margin:auto;
}

.card{
  background:#1a1a1a;
  padding:20px;
  border-radius:10px;
  margin-bottom:15px;
}

input, select{
  width:100%;
  padding:12px;
  margin-bottom:15px;
  border-radius:8px;
  border:none;
}

button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:8px;
  background:#d4af37;
  color:black;
  font-weight:bold;
  cursor:pointer;
}

.msg{
  text-align:center;
  margin-bottom:10px;
}

.sucesso{color:#00ff88;}
.erro{color:#ff4d4d;}
</style>
</head>
<body>

<div class="hero">
  <h1>Barbearia Elite</h1>
  <p>Tradição, Estilo e Precisão</p>
  <button class="btn" onclick="document.getElementById('agendamento').scrollIntoView()">Agendar Agora</button>
</div>

<div class="section">

<h2>Serviços</h2>

<div class="card">Corte — R$40</div>
<div class="card">Barba — R$30</div>
<div class="card">Corte + Barba — R$65</div>

</div>

<div class="section" id="agendamento">
<h2>Agendar Horário</h2>

<div id="mensagem" class="msg"></div>

<form id="formAgendamento">
  <input type="text" id="nome" placeholder="Seu nome" required>
  <input type="date" id="data" required>

  <select id="barbeiro" required>
    <option value="">Escolha o barbeiro</option>
    <option>João</option>
    <option>Carlos</option>
    <option>Marcos</option>
  </select>

  <select id="servico" required>
    <option value="">Escolha o serviço</option>
    <option>Corte</option>
    <option>Barba</option>
    <option>Corte + Barba</option>
  </select>

  <select id="hora" required>
    <option value="">Escolha o horário</option>
  </select>

  <button type="submit">Confirmar Agendamento</button>
</form>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getFirestore, 
  collection, 
  addDoc, 
  serverTimestamp, 
  query, 
  where, 
  getDocs 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyATJ3395a1qbFwThnszljqiVtstKFGggBI",
  authDomain: "barbearia-229f6.firebaseapp.com",
  projectId: "barbearia-229f6",
  storageBucket: "barbearia-229f6.firebasestorage.app",
  messagingSenderId: "161670457315",
  appId: "1:161670457315:web:4de0968caea1643e5c62d6"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const horariosFixos = [
"09:00","09:30","10:00","10:30",
"11:00","11:30","14:00","14:30",
"15:00","15:30","16:00","16:30"
];

const horaSelect = document.getElementById("hora");
const dataInput = document.getElementById("data");
const barbeiroSelect = document.getElementById("barbeiro");
const mensagem = document.getElementById("mensagem");

// Impedir datas passadas
const hoje = new Date().toISOString().split("T")[0];
dataInput.setAttribute("min", hoje);

async function carregarHorarios(){
  horaSelect.innerHTML = "<option value=''>Carregando...</option>";

  const data = dataInput.value;
  const barbeiro = barbeiroSelect.value;

  if(!data || !barbeiro) return;

  const q = query(
    collection(db, "agendamentos"),
    where("data", "==", data),
    where("barbeiro", "==", barbeiro)
  );

  const snapshot = await getDocs(q);
  const ocupados = snapshot.docs.map(doc => doc.data().horario);

  horaSelect.innerHTML = "<option value=''>Escolha o horário</option>";

  horariosFixos.forEach(h => {
    if(!ocupados.includes(h)){
      horaSelect.innerHTML += `<option>${h}</option>`;
    }
  });
}

dataInput.addEventListener("change", carregarHorarios);
barbeiroSelect.addEventListener("change", carregarHorarios);

document.getElementById("formAgendamento").addEventListener("submit", async (e)=>{
  e.preventDefault();

  const nome = document.getElementById("nome").value;
  const data = dataInput.value;
  const barbeiro = barbeiroSelect.value;
  const servico = document.getElementById("servico").value;
  const hora = horaSelect.value;

  if(!hora){
    mensagem.textContent="Escolha um horário disponível.";
    mensagem.className="msg erro";
    return;
  }

  await addDoc(collection(db,"agendamentos"),{
    nome,
    data,
    barbeiro,
    servico,
    horario:hora,
    status:"pendente",
    criadoEm:serverTimestamp()
  });

  mensagem.textContent="Agendamento confirmado!";
  mensagem.className="msg sucesso";
  e.target.reset();
  horaSelect.innerHTML="<option value=''>Escolha o horário</option>";
});
</script>

</body>
</html>